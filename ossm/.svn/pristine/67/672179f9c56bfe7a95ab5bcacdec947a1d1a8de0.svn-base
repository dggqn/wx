<!--pages/repair/repairDetail/repairDetail.wxml-->
<view class="container overflow-auto">
  <!-- 状态 -->
  <view class="public-apply-detail-top flex-align-items-center">
    <view class="detail-top-l flex-1">
      <block wx:if="{{detailData.status == 1 }}">
        <view class="top-l-status">待分配</view>
        <view class="top-l-tip">等待管理员分配任务</view>
      </block>
      <block wx:if="{{detailData.status == 2}}">
        <view class="top-l-status">待接受</view>
        <view class="top-l-tip">等待维修员接受任务</view>
      </block>
      <block wx:if="{{detailData.status == 3}}">
        <view class="top-l-status">待完成</view>
        <view class="top-l-tip">等待维修员完成任务</view>
      </block>
      <block wx:if="{{detailData.status == 5}}">
        <view class="top-l-status">已完成</view>
        <view class="top-l-tip">维修员已维修完毕</view>
      </block>
    </view>
    <view class="detail-top-r flex-1">
      <view class="top-r-id">
        <!-- ID:{{detailData.taskId}} -->
      </view>
      <view class="top-r-date">创建日期：{{detailData.createTime}}</view>
    </view>
  </view>
  <!-- 步骤 -->
  <view class="step-container">
    <view class="step-box flex-align-items-center">
      <view class="step-item flex-1 flex-align-items-center active-step">
        <view class="step-item-dot"></view>
      </view>
      <view class="step-item flex-1 flex-align-items-center {{detailData.status >1 ? 'active-step':''}}">
        <view class="step-item-dot"></view>
      </view>
      <view class="step-item flex-1 flex-align-items-center {{detailData.status >2 ? 'active-step':''}}">
        <view class="step-item-dot"></view>
      </view>
      <view class="step-item flex-1 flex-align-items-center {{detailData.status >4 ? 'active-step':''}}">
        <view class="step-item-dot"></view>
      </view>
    </view>
    <view class="step-detail flex">
      <view class="detail-item flex-1 {{detailData.status <6 ? 'active-detail':''}}">
        <view class="detail-item-intro">分配任务</view>
        <!-- <view class="detail-item-time">{{detailData.createTime}}</view> -->
      </view>
      <view class="detail-item flex-1 {{detailData.status >1 ? 'active-detail':''}}">
        <view class="detail-item-intro">维修员待接单</view>
        <!-- <view class="detail-item-time">2022/03/16</view> -->
      </view>
      <view class="detail-item flex-1 {{detailData.status >2 ? 'active-detail':''}}">
        <view class="detail-item-intro">维修员已接单</view>
        <!-- <view class="detail-item-time">2022/03/16</view> -->
      </view>
      <view class="detail-item flex-1 {{detailData.status >4 ? 'active-detail':''}}">
        <view class="detail-item-intro">维修完成</view>
        <view class="detail-item-time"></view>
      </view>
    </view>
  </view>
  <!-- 步骤End -->
  <view class="repair-main">
    <!-- 维修员 -->
    <view class="repair-person" wx:if="{{detailData.status == 3 ||detailData.status == 5 }}">
      <view class="person-top flex-align-items-center">
        <view class="person-img img-box">
          <image src="{{aliyunBaseImgUrlPre}}images/logo.png"></image>
        </view>
        <view class="person-name flex-1">
          <text>{{detailData.wxyUserName}}</text>
          <text class="person-type">维修员</text>
        </view>
        <view class="person-tel">
          <view></view>
        </view>
      </view>
      <view class="person-bottom">
        联系电话：{{detailData.wxyUserPhone}}
      </view>
    </view>
    <!-- 维修资产 -->
    <view wx:if="{{detailData.assetsName}}" class="repair-title">维修资产</view>
    <view wx:if="{{detailData.assetsName}}" class="repair-assets flex-align-items-center">
      <text class="assets-name flex-1">{{detailData.assetsName}}</text>
      <!-- <text class="assets-num">资产编号 H29BC2398</text> -->
    </view>
    <!-- 问题及描述 -->
    <view class="repair-title">问题及描述</view>
    <view class="repair-reasons">
      <view class="text-desc">
        <text>{{detailData.taskDescription}}</text>
        <!-- <view class="desc-top">
          <text>#机器发出异响#</text>
          <text>#无法关机#</text>
        </view>
        <view class="desc-bottom">
          机器试了几次都无法关机还蓝屏，非常紧急
        </view> -->
      </view>
      <view class="img-desc flex">
        <view class="img-desc-item img-box" bindtap='clickImg' data-id="0">
          <image src="{{detailData.fileList[0].url}}"   ></image>
        </view>
        <view class="img-desc-item img-box" bindtap='clickImg' data-id="1">
          <image src="{{detailData.fileList[1].url}}"></image>
        </view>
        <view class="img-desc-item img-box" bindtap='clickImg' data-id="2">
          <image src="{{detailData.fileList[2].url}}"></image>
        </view>
      </view>
    </view>
    <!-- 联系人 -->
    <view class="repair-title">联系人</view>
    <view class="contact-person">
      <view class="contact-person-item flex">
        <view class="flex-1">姓名</view>
        <view>{{detailData.userName}}</view>
      </view>
      <view class="contact-person-item flex">
        <view class="flex-1">电话</view>
        <view>{{detailData.userPhone}}</view>
      </view>
      <view class="contact-person-item flex">
        <view class="flex-1">地址</view>
        <view>{{detailData.taskPostion}}</view>
      </view>
    </view>
    
    <!-- 历史日志 -->
    <view class="repair-title">历史信息</view>
    <view class="contact-person">
      <view class="list-item" wx:for="{{hisData}}" wx:key="index" data-itemDetail="{{item}}">
        <view  wx:if="{{item.status=='0'}}">{{item.createTime}} {{item.createUname}}创建任务</view>
        <view  wx:if="{{item.status=='1'}}">{{item.createTime}} {{item.createUname}}分配任务至部门{{item.deptName}}</view>
        <view  wx:if="{{item.status=='2'}}">{{item.createTime}} {{item.createUname}}分配任务至维修员{{item.deptName}}</view>
        <view  wx:if="{{item.status=='3'}}">{{item.createTime}} 维修员{{item.createUname}}接受任务</view>
        <view  wx:if="{{item.status=='4'}}">{{item.createTime}} 维修员{{item.createUname}}拒绝任务</view>
        <view  wx:if="{{item.status=='5'}}">{{item.createTime}} {{item.createUname}}完成任务</view>
      </view>
    </view>
  </view>
  <view wx:if="{{detailData.status == 2  && detailData.userId  &&  detailData.userId == userInfo.userId}}" class="bottom-large-btn" bindtap="operationTask" data-taskid="{{detailData.workorderUserId}}" data-operation="1">
    <text class="operate-btn">接受任务</text>
  </view>
  <view wx:if="{{detailData.status == 1}}" class="bottom-large-btn" bindtap="goMemberList" data-taskid="{{detailData.workorderId}}">
    <text class="operate-btn">分配任务</text>
  </view>
  <view wx:if="{{detailData.status == 3  && detailData.userId  &&  detailData.userId == userInfo.userId}}" class="bottom-large-btn" bindtap="operationTask" data-taskid="{{detailData.workorderUserId}}" data-operation="2">
    <text class="operate-btn">完成任务</text>
  </view>
</view>